rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    function isSignedIn() {
  return request.auth != null;
		}

function userPath() {
  return /databases/$(database)/documents/users/$(request.auth.uid);
		}

function userRole() {
  return isSignedIn() && exists(userPath()) ? get(userPath()).data.rol : null;
		}

function hasRole(role) {
  return userRole() == role;
		}


	    // --- USERS ---
	    match /users/{uid} {
	      allow read: if isSignedIn() && request.auth.uid == uid;
	      allow create, update, delete: if false;
	    }

	    // --- ADMINS (flag para habilitar pantalla Admin) ---
	    match /admins/{uid} {
	      // Solo el propio usuario puede leer su flag
	      allow read: if isSignedIn() && request.auth.uid == uid;
	      // Nadie escribe desde el cliente
	      allow create, update, delete: if false;
	    }

	    // --- PACIENTES ---
	    match /pacientes/{id} {
	      // lectura para cualquier usuario logueado
	      allow read: if isSignedIn();
      // escritura solo auxiliar
      allow create, update, delete: if isSignedIn() && hasRole("AUXILIAR_ADMINISTRATIVA");
    }

    // --- EQUIPOS ---
  match /equipos/{id} {
  allow read: if isSignedIn();
  allow create, update, delete: if isSignedIn() && hasRole("INGENIERO_BIOMEDICO");
		}


    // --- ASIGNACIONES ---
    match /asignaciones/{id} {
      // lectura para cualquier usuario logueado
      allow read: if isSignedIn();
      // crear/actualizar solo auxiliar
      allow create, update: if isSignedIn() && hasRole("AUXILIAR_ADMINISTRATIVA");
      allow delete: if false;
    }

    // --- DENY DEFAULT ---
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
